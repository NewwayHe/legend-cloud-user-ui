!(function(t,e){ typeof exports === 'object' && typeof module !== 'undefined' ? e(exports) : typeof define === 'function' && define.amd ? define(['exports'],e) : e((t = typeof globalThis !== 'undefined' ? globalThis : t || self).Painter = {}) }(this,function(t){ 'use strict'; var e = function(){ return(e = Object.assign || function(t){ for(var e,i = 1,n = arguments.length; i < n; i++)for(var o in e = arguments[i])Object.prototype.hasOwnProperty.call(e,o) && (t[o] = e[o]); return t }).apply(this,arguments) }; function i(t,e,i,n){ return new (i || (i = Promise))(function(o,r){ function s(t){ try{ h(n.next(t)) }catch(t){ r(t) } }function a(t){ try{ h(n.throw(t)) }catch(t){ r(t) } }function h(t){ var e; t.done ? o(t.value) : (e = t.value,e instanceof i ? e : new i(function(t){ t(e) })).then(s,a) }h((n = n.apply(t,e || [])).next()) }) }function n(t,e){ var i; var n; var o; var r; var s = { label:0,sent:function(){ if(1 & o[0])throw o[1]; return o[1] },trys:[],ops:[] }; return r = { next:a(0),throw:a(1),return:a(2) },typeof Symbol === 'function' && (r[Symbol.iterator] = function(){ return this }),r; function a(r){ return function(a){ return (function(r){ if(i)throw new TypeError('Generator is already executing.'); for(;s;)try{ if(i = 1,n && (o = 2 & r[0] ? n.return : r[0] ? n.throw || ((o = n.return) && o.call(n),0) : n.next) && !(o = o.call(n,r[1])).done)return o; switch(n = 0,o && (r = [2 & r[0],o.value]),r[0]){ case 0:case 1:o = r; break; case 4:return s.label++,{ value:r[1],done:!1 }; case 5:s.label++,n = r[1],r = [0]; continue; case 7:r = s.ops.pop(),s.trys.pop(); continue; default:if(!(o = s.trys,(o = o.length > 0 && o[o.length - 1]) || r[0] !== 6 && r[0] !== 2)){ s = 0; continue }if(r[0] === 3 && (!o || r[1] > o[0] && r[1] < o[3])){ s.label = r[1]; break }if(r[0] === 6 && s.label < o[1]){ s.label = o[1],o = r; break }if(o && s.label < o[2]){ s.label = o[2],s.ops.push(r); break }o[2] && s.ops.pop(),s.trys.pop(); continue }r = e.call(t,s) }catch(t){ r = [6,t],n = 0 }finally{ i = o = 0 }if(5 & r[0])throw r[1]; return{ value:r[0] ? r[1] : void 0,done:!0 } }([r,a])) } } }var o; var r; var s = { MP_WEIXIN:'mp-weixin',MP_QQ:'mp-qq',MP_ALIPAY:'mp-alipay',MP_BAIDU:'mp-baidu',MP_TOUTIAO:'mp-toutiao',MP_DINGDING:'mp-dingding',H5:'h5',WEB:'web',PLUS:'plus' }; var a = 'row'; var h = 'column'; var d = 'view'; var l = 'text'; var c = 'image'; var f = 'qrcode'; var u = 'block'; var p = 'inline-block'; var g = 'none'; var v = 'flex'; var y = 'absolute'; var b = 'fixed'; var x = 'transparent'; var m = 'fill'; var w = { display:u,color:'#000000',lineHeight:'1.4em',fontSize:14,fontWeight:400,fontFamily:'sans-serif',lineCap:'butt',flexDirection:a,textAlign:'left',alignItems:'flex-start',justifyContent:'flex-start',position:'static',transformOrigin:'center center' }; var S = { upx2px:function(t){ return window.innerWidth / 750 * t },getSystemInfoSync:function(){ return{ screenWidth:window.innerWidth } },getImageInfo:function(t){ var e = t.src; var i = t.success; var n = t.fail; var o = new Image(); o.onload = function(){ i({ width:this.naturalWidth,height:this.naturalHeight,path:this.src,src:e }) },o.onerror = n,o.src = e } }; var z = 'object'; var M = 'undefined'; var B = typeof window === z ? typeof uni === M || typeof uni !== M && !uni.addInterceptor ? s.WEB : s.H5 : typeof swan === z ? s.MP_BAIDU : typeof tt === z ? s.MP_TOUTIAO : typeof plus === z ? s.PLUS : typeof wx === z ? s.MP_WEIXIN : void 0; var I = B == s.MP_WEIXIN ? wx : typeof uni !== M ? uni.getImageInfo ? { upx2px:function(t){ return uni.upx2px(t) },getSystemInfoSync:function(){ return uni.getSystemInfoSync() },getImageInfo:function(t){ return uni.getImageInfo(t) },downloadFile:function(t){ return uni.downloadFile(t) } } : Object.assign(uni,S) : typeof window !== M ? S : uni; if(!I.upx2px){ var k = ((r = I.getSystemInfoSync && ((o = uni.getSystemInfoSync()) === null || void 0 === o ? void 0 : o.screenWidth)) !== null && void 0 !== r ? r : 375) / 750; I.upx2px = function(t){ return k * t } }function P(t){ return/^-?\d+(\.\d+)?$/.test(t) }function W(t,e,i){ if(typeof t === 'number')return t; if(P(t))return 1 * t; if(typeof t === 'string'){ var n = /^-?([0-9]+)?([.]{1}[0-9]+){0,1}(em|rpx|px|%)$/g.exec(t); if(!t || !n)return 0; var o = n[3]; t = parseFloat(t); var r = 0; return o === 'rpx' ? r = I.upx2px(t) : o === 'px' ? r = 1 * t : o === '%' && e ? r = t * W(e) / 100 : o === 'em' && e && (r = t * W(e || 14)),1 * r.toFixed(2) }return 0 }var R = function(t){ return!(!t || !t.startsWith('linear') && !t.startsWith('radial')) }; var O = function(t,e,i,n,o,r){ t.startsWith('linear') ? (function(t,e,i,n,o,r){ for(var s = (function(t,e,i,n,o){ void 0 === n && (n = 0); void 0 === o && (o = 0); var r = t.match(/([-]?\d{1,3})deg/); var s = r && r[1] ? parseFloat(r[1]) : 0; s >= 360 && (s -= 360); s < 0 && (s += 360); if((s = Math.round(s)) === 0)return{ x0:Math.round(e / 2) + n,y0:i + o,x1:Math.round(e / 2) + n,y1:o }; if(s === 180)return{ x0:Math.round(e / 2) + n,y0:o,x1:Math.round(e / 2) + n,y1:i + o }; if(s === 90)return{ x0:n,y0:Math.round(i / 2) + o,x1:e + n,y1:Math.round(i / 2) + o }; if(s === 270)return{ x0:e + n,y0:Math.round(i / 2) + o,x1:n,y1:Math.round(i / 2) + o }; var a = Math.round(180 * Math.asin(e / Math.sqrt(Math.pow(e,2) + Math.pow(i,2))) / Math.PI); if(s === a)return{ x0:n,y0:i + o,x1:e + n,y1:o }; if(s === 180 - a)return{ x0:n,y0:o,x1:e + n,y1:i + o }; if(s === 180 + a)return{ x0:e + n,y0:o,x1:n,y1:i + o }; if(s === 360 - a)return{ x0:e + n,y0:i + o,x1:n,y1:o }; var h = 0; var d = 0; var l = 0; var c = 0; if(s < a || s > 180 - a && s < 180 || s > 180 && s < 180 + a || s > 360 - a){ var f = s * Math.PI / 180; var u = s < a || s > 360 - a ? i / 2 : -i / 2; var p = Math.tan(f) * u; var g = s < a || s > 180 - a && s < 180 ? e / 2 - p : -e / 2 - p; h = -(l = p + (v = Math.pow(Math.sin(f),2) * g)),d = -(c = u + v / Math.tan(f)) }if(s > a && s < 90 || s > 90 && s < 90 + a || s > 180 + a && s < 270 || s > 270 && s < 360 - a){ var v; f = (90 - s) * Math.PI / 180,p = s > a && s < 90 || s > 90 && s < 90 + a ? e / 2 : -e / 2,u = Math.tan(f) * p,g = s > a && s < 90 || s > 270 && s < 360 - a ? i / 2 - u : -i / 2 - u; h = -(l = p + (v = Math.pow(Math.sin(f),2) * g) / Math.tan(f)),d = -(c = u + v) }return h = Math.round(h + e / 2) + n,d = Math.round(i / 2 - d) + o,l = Math.round(l + e / 2) + n,c = Math.round(i / 2 - c) + o,{ x0:h,y0:d,x1:l,y1:c } }(o,t,e,i,n)),a = s.x0,h = s.y0,d = s.x1,l = s.y1,c = r.createLinearGradient(a,h,d,l),f = o.match(/linear-gradient\((.+)\)/)[1],u = T(f.substring(f.indexOf(',') + 1)),p = 0; p < u.colors.length; p++)c.addColorStop(u.percents[p],u.colors[p]); r.setFillStyle(c) }(e,i,n,o,t,r)) : t.startsWith('radial') && (function(t,e,i,n,o,r){ for(var s = T(o.match(/radial-gradient\((.+)\)/)[1]),a = Math.round(t / 2) + i,h = Math.round(e / 2) + n,d = r.createRadialGradient(a,h,0,a,h,Math.max(t,e) / 2),l = 0; l < s.colors.length; l++)d.addColorStop(s.percents[l],s.colors[l]); r.setFillStyle(d) }(e,i,n,o,t,r)) }; function T(t){ for(var e = [],i = [],n = 0,o = t.substring(0,t.length - 1).split('%,'); n < o.length; n++){ var r = o[n]; e.push(r.substring(0,r.lastIndexOf(' ')).trim()),i.push(r.substring(r.lastIndexOf(' '),r.length) / 100) }return{ colors:e,percents:i } }function L(t,e,i){ return e in t ? Object.defineProperty(t,e,{ value:i,enumerable:!0,configurable:!0,writable:!0 }) : t[e] = i,t }function A(){ return(A = Object.assign || function(t){ for(var e = 1; e < arguments.length; e++){ var i = arguments[e]; for(var n in i)Object.prototype.hasOwnProperty.call(i,n) && (t[n] = i[n]) }return t }).apply(this,arguments) }function F(t,e){ return(F = Object.setPrototypeOf || function(t,e){ return t.__proto__ = e,t })(t,e) }function j(t,e){ (e == null || e > t.length) && (e = t.length); for(var i = 0,n = new Array(e); i < e; i++)n[i] = t[i]; return n }function C(t,e){ var i = typeof Symbol !== 'undefined' && t[Symbol.iterator] || t['@@iterator']; if(i)return(i = i.call(t)).next.bind(i); if(Array.isArray(t) || (i = (function(t,e){ if(t){ if(typeof t === 'string')return j(t,e); var i = Object.prototype.toString.call(t).slice(8,-1); return i === 'Object' && t.constructor && (i = t.constructor.name),i === 'Map' || i === 'Set' ? Array.from(t) : i === 'Arguments' || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i) ? j(t,e) : void 0 } }(t))) || e && t && typeof t.length === 'number'){ i && (t = i); var n = 0; return function(){ return n >= t.length ? { done:!0 } : { done:!1,value:t[n++] } } }throw new TypeError('Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.') }function E(t){ return typeof t === 'number' }function H(t){ return t === 'auto' || t === null }function $(t){ return/%$/.test(t) }var U; var _ = 0; var D = (function(){ function t(){ L(this,'elements',[]),L(this,'afterElements',[]),L(this,'beforeElements',[]),L(this,'ids',[]),L(this,'width',0),L(this,'height',0),L(this,'top',0),L(this,'left',0),L(this,'pre',null),L(this,'offsetX',0),L(this,'offsetY',0),_++,this.id = _ }var e = t.prototype; return e.fixedBind = function(t,e){ void 0 === e && (e = 0),this.container = e ? t.parent : t.root,this.container.fixedLine = this,this.fixedAdd(t) },e.fixedAdd = function(t){ this.elements.push(t); var e = t.computedStyle.zIndex; (void 0 === e ? 0 : e) >= 0 ? this.afterElements.push(t) : this.beforeElements.push(t),this.refreshLayout() },e.bind = function(t){ this.container = t.parent,this.container.line = null,this.container.lines ? (this.container.lines.push(this),this.pre = this.getPreLine(),this.top = this.pre.top + this.pre.height,this.left = this.container.contentSize.left) : (this.top = this.container.contentSize.top,this.left = this.container.contentSize.left,this.container.lines = [this]),this.isInline = t.isInline(),this.container.line = this,this.outerWidth = t.parent && t.parent.contentSize.width ? t.parent.contentSize.width : 1 / 0,this.add(t) },e.getPreLine = function(){ return this.container.lines[this.container.lines.length - 2] },e.canIEnter = function(t){ return!((100 * t.offsetSize.width + 100 * this.width) / 100 > this.outerWidth) || (this.closeLine(),!1) },e.closeLine = function(){ delete this.container.line },e.add = function(t){ this.ids.push(t.id),this.elements.push(t),this.refreshWidthHeight(t) },e.refreshWidthHeight = function(t){ t.offsetSize.height > this.height && (this.height = t.offsetSize.height),this.width += t.offsetSize.width || 0,(this.container.lineMaxWidth || 0) < this.width && (this.container.lineMaxWidth = this.width) },e.refreshXAlign = function(){ if(this.isInline){ var t = this.container.contentSize.width - this.width; var e = this.container.style.textAlign; e === 'center' ? t /= 2 : e === 'left' && (t = 0),this.offsetX = t } },e.getOffsetY = function(t){ var e = t.style.verticalAlign; return e === 'bottom' ? this.height - t.contentSize.height : e === 'middle' ? (this.height - t.contentSize.height) / 2 : 0 },e.layout = function(t,e){ for(var i in this.refreshXAlign(),this.pre ? (this.top = this.pre.top + this.pre.height + this.offsetY,this.left = e + this.offsetX) : (this.top = Math.max(this.top,this.container.contentSize.top,t) + this.offsetY,this.left = Math.max(this.left,this.container.contentSize.left,e) + this.offsetX),this.elements){ var n = this.elements[i]; var o = this.elements[i - 1]; var r = this.getOffsetY(n); n.style.top = this.top + r,n.style.left = o ? o.offsetSize.left + o.offsetSize.width : this.left,n.getBoxPosition2() } },e.refreshLayout = function(){ this.afterElements = this.afterElements.sort(function(t,e){ return t.computedStyle.zIndex - e.computedStyle.zIndex }),this.beforeElements = this.beforeElements.sort(function(t,e){ return t.computedStyle.zIndex - e.computedStyle.zIndex }) },t }()); var X = ((U = {})[a] = { width:'width',contentWidth:'width',x:'x',y:'y',contentX:'left',height:'height',contentHeight:'height' },U[h] = { width:'height',contentWidth:'height',x:'y',y:'x',contentX:'top',height:'width',contentHeight:'width' },U); var N = (function(t){ var e,i; function n(){ var e; return L((function(t){ if(void 0 === t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return t }(e = t.call(this) || this)),'outerWidth',0),e.exactValue = 0,e.flexTotal = 0,e.key = null,e }i = t,(e = n).prototype = Object.create(i.prototype),e.prototype.constructor = e,F(e,i); var o = n.prototype; return o.bind = function(t){ this.container = t.parent,this.container.line = this,this.container.lines = [this],t.parent && (this.key = X[t.parent.style.flexDirection]),this.initHeight(t),this.outerWidth = t.parent && t.parent.contentSize[this.key.contentWidth] ? t.parent.contentSize[this.key.contentWidth] : 1 / 0,this.add(t) },o.add = function(t){ this.ids.push(t.id),E(t.style.flex) ? this.flexTotal += t.style.flex : E(t.style[this.key.width]) && (this.exactValue += t.contentSize[this.key.width]),this.elements.push(t),this.refreshWidthHeight(t),t.next || this.closeLine() },o.canIEnter = function(t){ return!t.next },o.closeLine = function(){ this.calcFlex() },o.initHeight = function(t){ this[this.key.height] = 0 },o.calcFlex = function(){ var t = this; var e = this.container.contentSize[this.key.contentWidth]; this.elements.forEach(function(i){ var n = i.style.width || 0; E(i.style.flex) && (n = i.style.flex / t.flexTotal * (e - t.exactValue)),i.computedStyle[t.key.width] = n,i.getBoxWidthHeight() }) },o.refreshWidthHeight = function(t){ this.container.style.alignItems && !t.style.alignSelf && (t.style.alignSelf = this.container.style.alignItems),t.contentSize[this.key.height] > this[this.key.height] && (this[this.key.height] = t.offsetSize[this.key.height]),this[this.key.width] += t.offsetSize[this.key.width],(this.container.lineMaxWidth || 0) < this[this.key.width] && (this.container.lineMaxWidth = this[this.key.width]) },o.refreshXAlign = function(){ var t = this; var e = this.elements.reduce(function(e,i){ return e + i.offsetSize[t.key.width] },0); var i = this.outerWidth == 1 / 0 ? 0 : this.outerWidth - Math.max(this[this.key.width],e); this.container.style.justifyContent === 'center' ? i /= 2 : this.container.style.justifyContent === 'flex-start' && (i = 0),this.offsetX = i },o.refreshYAlign = function(){},o.getOffsetY = function(t){ return t.style.alignSelf === 'flex-end' ? this.container.contentSize[this.key.contentHeight] - t.contentSize[this.key.height] : t.style.alignSelf === 'center' ? (this.container.contentSize[this.key.contentHeight] - t.contentSize[this.key.height]) / 2 : 0 },n }(D)); var Y = c; var V = l; var G = d; var q = f; var J = u; var Q = p; var Z = v; var K = y; var et = b; var it = 0; var nt = { left:null,top:null,width:null,height:null }; var ot = (function(){ function t(t,e,i,n){ var o = this; L(this,'id',it++),L(this,'style',{ left:null,top:null,width:null,height:null }),L(this,'computedStyle',{}),L(this,'originStyle',{}),L(this,'children',{}),L(this,'layoutBox',A({},nt)),L(this,'contentSize',A({},nt)),L(this,'clientSize',A({},nt)),L(this,'borderSize',A({},nt)),L(this,'offsetSize',A({},nt)),this.ctx = n,this.root = i,e && (this.parent = e),this.name = t.name || t.type,this.attributes = this.getAttributes(t); var r = this.getComputedStyle(t,e == null ? void 0 : e.computedStyle); this.isAbsolute = r.position == K,this.isFixed = r.position == et,this.originStyle = r,Object.keys(r).forEach(function(t){ Object.defineProperty(o.style,t,{ configurable:!0,enumerable:!0,get:function(){ return r[t] },set:function(e){ r[t] = e } }) }); var s = { contentSize:A({},this.contentSize),clientSize:A({},this.clientSize),borderSize:A({},this.borderSize),offsetSize:A({},this.offsetSize) }; Object.keys(s).forEach(function(t){ Object.keys(o[t]).forEach(function(e){ Object.defineProperty(o[t],e,{ configurable:!0,enumerable:!0,get:function(){ return s[t][e] },set:function(i){ s[t][e] = i } }) }) }),this.computedStyle = this.style }var e = t.prototype; return e.add = function(t){ t.parent = this,this.children[t.id] = t },e.getChildren = function(){ var t = this; return Object.keys(this.children).map(function(e){ return t.children[e] }) },e.getLineRect = function(t,e){ var i = { width:0,height:0 }; var n = e ? e.lines : this.parent && this.parent.lines; return n && n.find(function(e){ return e.ids.includes(t) }) || i },e.getComputedStyle = function(t,e){ var i = ['color','fontSize','lineHeight','verticalAlign','fontWeight','textAlign']; var n = t.css; var o = void 0 === n ? {} : n; var r = t.type; var s = void 0 === r ? G : r; var a = A({},w); if([V,Y,q].includes(s) && !o.display && (a.display = Q),e)for(var h = 0; h < i.length; h++){ var d = i[h]; (o[d] || e[d]) && (o[d] = o[d] || e[d]) }for(var l = function(){ var t = f[c]; var e = o[t]; if(/-/.test(t) && (t = t.replace(/-([a-z])/g,function(t,e){ return e.toUpperCase() }),a.key = e),/^(box)?shadow$/i.test(t)){ var i = []; return e.replace(/((\d+(rpx|px)?\s+?){3})(.+)/,function(){ for(var t = arguments.length,e = new Array(t),n = 0; n < t; n++)e[n] = arguments[n]; i = e[1].match(/\d+(rpx|px)?/g).map(function(t){ return W(t) }).concat(e[4]) }),a.boxShadow = i,'continue' }if(/^border/i.test(t) && !/radius$/i.test(t)){ var n; var r = t.match(/^border([BTRLa-z]+)?/)[0]; var h = t.match(/[W|S|C][a-z]+/); var d = e.replace(/([\(,])\s+|\s+([\),])/g,'$1$2').split(' ').map(function(t){ return/^\d/.test(t) ? W(t,'') : t }); return a[r] = ((n = {})[r + 'Width'] = P(d[0]) ? d[0] : 0,n[r + 'Style'] = d[1] || 'solid',n[r + 'Color'] = d[2] || 'black',n),d.length == 1 && h && (a[r][r + h[0]] = d[0]),'continue' }if(/^background(color)?$/i.test(t))return a.backgroundColor = e,'continue'; if(/^objectPosition$/i.test(t))return a[t] = e.split(' '),'continue'; if(/padding|margin|radius/i.test(t)){ var l = /radius$/i.test(t); var u = l ? 'borderRadius' : t.match(/[a-z]+/)[0]; var p = [0,0,0,0].map(function(t,e){ return l ? ['borderTopLeftRadius','borderTopRightRadius','borderBottomRightRadius','borderBottomLeftRadius'][e] : [u + 'Top',u + 'Right',u + 'Bottom',u + 'Left'][e] }); var g = 'margin'; if(t === 'padding' || t === g || /^(border)?radius$/i.test(t)){ var v; var y = (e == null ? void 0 : e.split(' ').map(function(e){ return/^\d+(rpx|px)?$/.test(e) ? W(e) : t != g && /auto/.test(e) ? 0 : e },[])) || [0]; var b = l ? 'borderRadius' : t; var x = y[0]; var m = y[1]; var w = y[2]; var S = y[3]; a[b] = ((v = {})[p[0]] = H(x) ? 0 : x,v[p[1]] = P(m) || H(m) ? m : x,v[p[2]] = H(P(w) ? w : x) ? 0 : P(w) ? w : x,v[p[3]] = P(S) ? S : m || x,v) }else{ var z; if(typeof a[u] === 'object')a[u][t] = u == g && H(e) || $(e) ? e : W(e); else a[u] = ((z = {})[p[0]] = a[u] || 0,z[p[1]] = a[u] || 0,z[p[2]] = a[u] || 0,z[p[3]] = a[u] || 0,z),a[u][t] = u == g && H(e) || $(e) ? e : W(e) }return'continue' }if(/^transform$/i.test(t))return a[t] = {},e.replace(/([a-zA-Z]+)\(([0-9,-\.%rpxdeg\s]+)\)/g,function(e,i,n){ var r = n.split(',').map(function(t){ return t.replace(/(^\s*)|(\s*$)/g,'') }); var s = function(t,e){ return t.includes('deg') ? 1 * t : e && !/%$/.test(e) ? W(t,e) : t }; i.includes('matrix') ? a[t][i] = r.map(function(t){ return 1 * t }) : i.includes('rotate') ? a[t][i] = 1 * n.match(/^-?\d+(\.\d+)?/)[0] : /[X, Y]/.test(i) ? a[t][i] = /[X]/.test(i) ? s(r[0],o.width) : s(r[0],o.height) : (a[t][i + 'X'] = s(r[0],o.width),a[t][i + 'Y'] = s(r[1] || r[0],o.height)) }),'continue'; /^font$/i.test(t) && console.error('font 不支持简写'),/^left|top$/i.test(t) && ![K,et].includes(o.position) ? a[t] = 0 : a[t] = /^[\d\.]+(px|rpx)?$/.test(e) ? W(e) : /em$/.test(e) && s == 'text' ? W(e,o.fontSize) : e },c = 0,f = Object.keys(o); c < f.length; c++)l(); return a },e.setPosition = function(t,e){ var i = { left:'width',top:'height',right:'width',bottom:'height' }; Object.keys(i).forEach(function(n){ var o = n == 'right' ? 'left' : 'top'; ['right','bottom'].includes(n) && void 0 !== t.style[n] && typeof t.originStyle[o] !== 'number' ? t.style[o] = e[i[n]] - t.offsetSize[i[n]] - W(t.style[n],e[i[n]]) : t.style[n] = W(t.style[n],e[i[n]]) }) },e.getAttributes = function(t){ var e = t.attributes || {}; return(t.url || t.src) && (e.src = e.src || t.url || t.src),t.replace && (e.replace = t.replace),t.text && (e.text = t.text),e },e.getOffsetSize = function(t,e,i){ void 0 === i && (i = 'offsetSize'); var n = e || {}; var o = n.margin; var r = (o = void 0 === o ? {} : o).marginLeft; var s = void 0 === r ? 0 : r; var a = o.marginTop; var h = void 0 === a ? 0 : a; var d = o.marginRight; var l = void 0 === d ? 0 : d; var c = o.marginBottom; var f = void 0 === c ? 0 : c; var u = n.padding; var p = (u = void 0 === u ? {} : u).paddingLeft; var g = void 0 === p ? 0 : p; var v = u.paddingTop; var y = void 0 === v ? 0 : v; var b = u.paddingRight; var x = void 0 === b ? 0 : b; var m = u.paddingBottom; var w = void 0 === m ? 0 : m; var S = n.border; var z = (S = void 0 === S ? {} : S).borderWidth; var M = void 0 === z ? 0 : z; var B = n.borderTop; var I = (B = void 0 === B ? {} : B).borderTopWidth; var k = void 0 === I ? M : I; var P = n.borderBottom; var W = (P = void 0 === P ? {} : P).borderBottomWidth; var R = void 0 === W ? M : W; var O = n.borderRight; var T = (O = void 0 === O ? {} : O).borderRightWidth; var L = void 0 === T ? M : T; var A = n.borderLeft; var F = (A = void 0 === A ? {} : A).borderLeftWidth; var j = void 0 === F ? M : F; var C = s < 0 && l < 0 ? Math.abs(s + l) : 0; var E = h < 0 && f < 0 ? Math.abs(h + f) : 0; var H = s >= 0 && l < 0; var $ = h >= 0 && f < 0; return i == 'contentSize' && (this[i].left = t.left + s + g + j + (H ? 2 * -l : 0),this[i].top = t.top + h + y + k + ($ ? 2 * -f : 0),this[i].width = t.width + (this[i].widthAdd ? 0 : C),this[i].height = t.height + (this[i].heightAdd ? 0 : E),this[i].widthAdd = C,this[i].heightAdd = E),i == 'clientSize' && (this[i].left = t.left + s + j + (H < 0 ? -l : 0),this[i].top = t.top + h + k + ($ ? -f : 0),this[i].width = t.width + g + x,this[i].height = t.height + y + w),i == 'borderSize' && (this[i].left = t.left + s + j / 2 + (H < 0 ? -l : 0),this[i].top = t.top + h + k / 2 + ($ ? -f : 0),this[i].width = t.width + g + x + j / 2 + L / 2,this[i].height = t.height + y + w + R / 2 + k / 2),i == 'offsetSize' && (this[i].left = t.left + (H < 0 ? -l : 0),this[i].top = t.top + ($ ? -f : 0),this[i].width = t.width + g + x + j + L + s + l,this[i].height = t.height + y + w + R + k + f + h),this[i] },e.layoutBoxUpdate = function(t,e,i,n){ if(void 0 === i && (i = -1),e.boxSizing == 'border-box'){ var o = e || {}; var r = o.border; var s = (r = void 0 === r ? {} : r).borderWidth; var a = void 0 === s ? 0 : s; var h = o.borderTop; var d = (h = void 0 === h ? {} : h).borderTopWidth; var l = void 0 === d ? a : d; var c = o.borderBottom; var f = (c = void 0 === c ? {} : c).borderBottomWidth; var u = void 0 === f ? a : f; var p = o.borderRight; var g = (p = void 0 === p ? {} : p).borderRightWidth; var v = void 0 === g ? a : g; var y = o.borderLeft; var b = (y = void 0 === y ? {} : y).borderLeftWidth; var x = void 0 === b ? a : b; var m = o.padding; var w = (m = void 0 === m ? {} : m).paddingTop; var S = void 0 === w ? 0 : w; var z = m.paddingRight; var M = void 0 === z ? 0 : z; var B = m.paddingBottom; var I = void 0 === B ? 0 : B; var k = m.paddingLeft; var P = void 0 === k ? 0 : k; i || (t.width -= P + M + v + x),i !== 1 || n || (t.height -= S + I + l + u) }this.layoutBox && (this.layoutBox.contentSize = this.getOffsetSize(t,e,'contentSize'),this.layoutBox.clientSize = this.getOffsetSize(t,e,'clientSize'),this.layoutBox.borderSize = this.getOffsetSize(t,e,'borderSize'),this.layoutBox.offsetSize = this.getOffsetSize(t,e,'offsetSize'),this.layoutBox = Object.assign({},this.layoutBox,this.layoutBox.borderSize)) },e.getBoxPosition2 = function(){ var t = this.computedStyle; var e = this.fixedLine; var i = this.lines; var n = t.left; var o = void 0 === n ? 0 : n; var r = t.top; var s = void 0 === r ? 0 : r; var a = t.padding || {}; var h = a.paddingBottom; var d = void 0 === h ? 0 : h; var l = a.paddingRight; var c = void 0 === l ? 0 : l; var f = A({},this.contentSize,{ left:o,top:s }); var u = this.contentSize.top - this.offsetSize.top; var p = this.contentSize.left - this.offsetSize.left; if(this.root.fixedLine && !this.root.isDone){ this.root.isDone = !0; for(var g,v = C(this.root.fixedLine.elements); !(g = v()).done;){ var y = g.value; y.setPosition(y,this.root.offsetSize),y.getBoxPosition2() } }if(e)for(var b,x = C(e.elements); !(b = x()).done;){ var m = b.value; m.setPosition(m,f),m.style.left += o + p + c,m.style.top += s + u + d,m.getBoxPosition2() }if(i)for(var w,S = C(i); !(w = S()).done;){ w.value.layout(f.top + u,f.left + p) }return this.layoutBoxUpdate(f,t),this.layoutBox },e.getBoxState = function(t,e){ return this.isBlock(t) || this.isBlock(e) },e.isBlock = function(t){ return void 0 === t && (t = this),t && t.style.display == J },e.isFlex = function(t){ return void 0 === t && (t = this),t && t.style.display == Z },e.isInFlow = function(){ return!(this.isAbsolute || this.isFixed) },e.inFlexBox = function(t){ return void 0 === t && (t = this),!!t.isInFlow() && (!!t.parent && (!(!t.parent || t.parent.style.display !== Z) || void 0)) },e.isInline = function(t){ return void 0 === t && (t = this),t && t.style.display == Q },e.contrastSize = function(t,e,i){ var n = t; return i && (n = Math.min(n,i)),e && (n = Math.max(n,e)),n },e.measureText = function(t,e){ var i = this.ctx.measureText(t); return{ width:i.width,fontHeight:(i.actualBoundingBoxAscent || 0.7 * e) + 1 } },e.getBoxWidthHeight = function(){ var t; var e = this; var i = this.name; var n = this.computedStyle; var o = this.attributes; var r = this.parent; var s = void 0 === r ? {} : r; var a = this.ctx; var h = this.getChildren(); var d = n.left; var l = void 0 === d ? 0 : d; var c = n.top; var f = void 0 === c ? 0 : c; var u = n.bottom; var p = n.right; var g = n.width; var v = void 0 === g ? 0 : g; var y = n.minWidth; var b = n.maxWidth; var x = n.minHeight; var m = n.maxHeight; var w = n.height; var S = void 0 === w ? 0 : w; var z = n.fontSize; var M = void 0 === z ? 14 : z; var B = n.fontWeight; var I = n.fontFamily; var k = n.fontStyle; var P = n.position; var R = n.lineClamp; var O = n.lineHeight; var T = n.padding; var L = void 0 === T ? {} : T; var A = n.margin; var F = void 0 === A ? {} : A; var j = n.border; var C = (j = void 0 === j ? {} : j).borderWidth; var E = void 0 === C ? 0 : C; var H = n.borderRight; var U = (H = void 0 === H ? {} : H).borderRightWidth; var _ = void 0 === U ? E : U; var X = n.borderLeft; var q = (X = void 0 === X ? {} : X).borderLeftWidth; var J = void 0 === q ? E : q; var Q = s.contentSize && s.contentSize.width; var Z = s.contentSize && s.contentSize.height; if($(v) && Q && (v = W(v,Q)),$(v) && !Q && (v = null),$(S) && Z && (S = W(S,Z)),$(S) && !Z && (S = null),$(y) && Q && (y = W(y,Q)),$(b) && Q && (b = W(b,Q)),$(x) && Z && (x = W(x,Z)),$(m) && Z && (m = W(m,Z)),n.padding && (t = s.contentSize) != null && t.width)for(var tt in n.padding)Object.hasOwnProperty.call(n.padding,tt) && (n.padding[tt] = W(n.padding[tt],Q)); var et = L.paddingRight; var it = void 0 === et ? 0 : et; var nt = L.paddingLeft; var ot = void 0 === nt ? 0 : nt; if(n.margin && [n.margin.marginLeft,n.margin.marginRight].includes('auto'))if(v){ var rt = Q && Q - v - it - ot - J - _ || 0; n.margin.marginLeft == n.margin.marginRight ? n.margin.marginLeft = n.margin.marginRight = rt / 2 : n.margin.marginLeft == 'auto' ? n.margin.marginLeft = rt : n.margin.marginRight = rt }else n.margin.marginLeft = n.margin.marginRight = 0; var st = F.marginRight; var at = void 0 === st ? 0 : st; var ht = F.marginLeft; var dt = { width:v,height:S,left:0,top:0 }; var lt = ot + it + J + _ + (void 0 === ht ? 0 : ht) + at; if(i == V && !this.attributes.widths){ var ct = o.text || ''; a.save(),a.setFonts({ fontFamily:I,fontSize:M,fontWeight:B,fontStyle:k }); var ft = new Map(); ct.split('\n').map(function(t){ var i = t.split('').map(function(t){ var i = ft.get(t); if(i)return i; var n = e.measureText(t,M).width; return ft.set(t,n),n }); e.attributes.fontHeight = e.measureText(t,M).fontHeight,e.attributes.widths || (e.attributes.widths = []),e.attributes.widths.push({ widths:i,total:i.reduce(function(t,e){ return t + e },0) }) }),a.restore() }if(i == Y && v == null){ var ut = o.width; var pt = o.height; dt.width = this.contrastSize(Math.round(ut * S / pt) || 0,y,b),this.layoutBoxUpdate(dt,n,0) }if(i == V && v == null){ var gt = this.attributes.widths; var vt = Math.max.apply(Math,gt.map(function(t){ return t.total })); if(s && Q > 0 && (vt > Q || this.isBlock(this)) && !this.isAbsolute && !this.isFixed)vt = Q - lt; dt.width = this.contrastSize(vt,y,b),this.layoutBoxUpdate(dt,n,0) }if(i == V && !this.attributes.lines){ var yt = this.attributes.widths.length; this.attributes.widths.forEach(function(t){ return t.widths.reduce(function(t,e,i){ return t + e > dt.width ? (yt++,e) : t + e },0) }),yt = R && yt > R ? R : yt,this.attributes.lines = yt }if(i == Y && S == null){ var bt = o.width; var xt = o.height; dt.height = this.contrastSize(W(dt.width * xt / bt) || 0,x,m),this.layoutBoxUpdate(dt,n,1) }i == V && S == null && (O = W(O,M),dt.height = this.contrastSize(W(this.attributes.lines * O),x,m),this.layoutBoxUpdate(dt,n,1,!0)),this.isInFlow() && s && s.children && Q && ([G,V].includes(i) && this.isFlex() || i == G && this.isBlock(this)) && (dt.width = this.contrastSize(Q - lt,y,b),this.layoutBoxUpdate(dt,n)),v && !$(v) && (dt.width = this.contrastSize(v,y,b),this.layoutBoxUpdate(dt,n,0)),S && !$(S) && (dt.height = this.contrastSize(dt.height,x,m),this.layoutBoxUpdate(dt,n,1)); var mt = 0; if(h.length){ var wt = null; h.forEach(function(t,i){ t.getBoxWidthHeight(); var n = h[i + 1]; if(n && n.isInFlow() && (t.next = n),t.isInFlow() && !t.inFlexBox()){ var o = e.getBoxState(wt,t); e.line && e.line.canIEnter(t) && !o ? e.line.add(t) : (new D()).bind(t),wt = t }else t.inFlexBox() ? e.line && e.line.canIEnter(t) ? e.line.add(t) : (console.warn('[painter] flex-box 功能未完善 请勿使用'),(new N()).bind(t)) : t.isFixed ? e.root.fixedLine ? e.root.fixedLine.fixedAdd(t) : (new D()).fixedBind(t) : e.fixedLine ? e.fixedLine.fixedAdd(t) : (new D()).fixedBind(t,1) }),this.lines && (mt = this.lines.reduce(function(t,e){ return t + e.height },0)) }var St = 0; var zt = 0; if(!v && (this.isAbsolute || this.isFixed) && Q){ var Mt = P == K ? Q : this.root.width; var Bt = Mt - (/%$/.test(l) ? W(l,Mt) : l) - (/%$/.test(p) ? W(p,Mt) : p); St = n.left ? Bt : this.lineMaxWidth }if(!S && (f != null ? f : this.isAbsolute || this.isFixed && Z)){ var It = P == K ? Z : this.root.height; var kt = It - (/%$/.test(f) ? W(f,It) : f) - (/%$/.test(u) ? W(u,It) : u); zt = n.top ? kt : 0 }if(v && !$(v) || dt.width || (dt.width = St || this.contrastSize((this.isBlock(this) ? Q || s.lineMaxWidth : this.lineMaxWidth) || this.lineMaxWidth,y,b),this.layoutBoxUpdate(dt,n,0)),S || !mt && !zt || (dt.height = zt || this.contrastSize(mt,x,m),this.layoutBoxUpdate(dt,n)),n.borderRadius && this.borderSize && this.borderSize.width)for(var Pt in n.borderRadius)Object.hasOwnProperty.call(n.borderRadius,Pt) && (n.borderRadius[Pt] = W(n.borderRadius[Pt],this.borderSize.width)); return this.layoutBox },e.layout = function(){ return this.getBoxWidthHeight(),this.root.offsetSize = this.offsetSize,this.getBoxPosition2(),this.offsetSize },t }()); var rt = (function(){ var t; var e; var i; var n; var o; var r; var s = [0,11,15,19,23,27,31,16,18,20,22,24,26,28,20,22,24,24,26,28,28,22,24,24,26,26,28,28,24,24,26,26,26,28,28,24,26,26,26,28,28]; var a = [3220,1468,2713,1235,3062,1890,2119,1549,2344,2936,1117,2583,1330,2470,1667,2249,2028,3780,481,4011,142,3098,831,3445,592,2517,1776,2234,1951,2827,1070,2660,1345,3177]; var h = [30660,29427,32170,30877,26159,25368,27713,26998,21522,20773,24188,23371,17913,16590,20375,19104,13663,12392,16177,14854,9396,8579,11994,11245,5769,5054,7399,6608,1890,597,3340,2107]; var d = [1,0,19,7,1,0,16,10,1,0,13,13,1,0,9,17,1,0,34,10,1,0,28,16,1,0,22,22,1,0,16,28,1,0,55,15,1,0,44,26,2,0,17,18,2,0,13,22,1,0,80,20,2,0,32,18,2,0,24,26,4,0,9,16,1,0,108,26,2,0,43,24,2,2,15,18,2,2,11,22,2,0,68,18,4,0,27,16,4,0,19,24,4,0,15,28,2,0,78,20,4,0,31,18,2,4,14,18,4,1,13,26,2,0,97,24,2,2,38,22,4,2,18,22,4,2,14,26,2,0,116,30,3,2,36,22,4,4,16,20,4,4,12,24,2,2,68,18,4,1,43,26,6,2,19,24,6,2,15,28,4,0,81,20,1,4,50,30,4,4,22,28,3,8,12,24,2,2,92,24,6,2,36,22,4,6,20,26,7,4,14,28,4,0,107,26,8,1,37,22,8,4,20,24,12,4,11,22,3,1,115,30,4,5,40,24,11,5,16,20,11,5,12,24,5,1,87,22,5,5,41,24,5,7,24,30,11,7,12,24,5,1,98,24,7,3,45,28,15,2,19,24,3,13,15,30,1,5,107,28,10,1,46,28,1,15,22,28,2,17,14,28,5,1,120,30,9,4,43,26,17,1,22,28,2,19,14,28,3,4,113,28,3,11,44,26,17,4,21,26,9,16,13,26,3,5,107,28,3,13,41,26,15,5,24,30,15,10,15,28,4,4,116,28,17,0,42,26,17,6,22,28,19,6,16,30,2,7,111,28,17,0,46,28,7,16,24,30,34,0,13,24,4,5,121,30,4,14,47,28,11,14,24,30,16,14,15,30,6,4,117,30,6,14,45,28,11,16,24,30,30,2,16,30,8,4,106,26,8,13,47,28,7,22,24,30,22,13,15,30,10,2,114,28,19,4,46,28,28,6,22,28,33,4,16,30,8,4,122,30,22,3,45,28,8,26,23,30,12,28,15,30,3,10,117,30,3,23,45,28,4,31,24,30,11,31,15,30,7,7,116,30,21,7,45,28,1,37,23,30,19,26,15,30,5,10,115,30,19,10,47,28,15,25,24,30,23,25,15,30,13,3,115,30,2,29,46,28,42,1,24,30,23,28,15,30,17,0,115,30,10,23,46,28,10,35,24,30,19,35,15,30,17,1,115,30,14,21,46,28,29,19,24,30,11,46,15,30,13,6,115,30,14,23,46,28,44,7,24,30,59,1,16,30,12,7,121,30,12,26,47,28,39,14,24,30,22,41,15,30,6,14,121,30,6,34,47,28,46,10,24,30,2,64,15,30,17,4,122,30,29,14,46,28,49,10,24,30,24,46,15,30,4,18,122,30,13,32,46,28,48,14,24,30,42,32,15,30,20,4,117,30,40,7,47,28,43,22,24,30,10,67,15,30,19,6,118,30,18,31,47,28,34,34,24,30,20,61,15,30]; var l = [255,0,1,25,2,50,26,198,3,223,51,238,27,104,199,75,4,100,224,14,52,141,239,129,28,193,105,248,200,8,76,113,5,138,101,47,225,36,15,33,53,147,142,218,240,18,130,69,29,181,194,125,106,39,249,185,201,154,9,120,77,228,114,166,6,191,139,98,102,221,48,253,226,152,37,179,16,145,34,136,54,208,148,206,143,150,219,189,241,210,19,92,131,56,70,64,30,66,182,163,195,72,126,110,107,58,40,84,250,133,186,61,202,94,155,159,10,21,121,43,78,212,229,172,115,243,167,87,7,112,192,247,140,128,99,13,103,74,222,237,49,197,254,24,227,165,153,119,38,184,180,124,17,68,146,217,35,32,137,46,55,63,209,91,149,188,207,205,144,135,151,178,220,252,190,97,242,86,211,171,20,42,93,158,132,60,57,83,71,109,65,162,31,45,67,216,183,123,164,118,196,23,73,236,127,12,111,246,108,161,59,82,41,157,85,170,251,96,134,177,187,204,62,90,203,89,95,176,156,169,160,81,11,245,22,235,122,117,44,215,79,174,213,233,230,231,173,232,116,214,244,234,168,80,88,175]; var c = [1,2,4,8,16,32,64,128,29,58,116,232,205,135,19,38,76,152,45,90,180,117,234,201,143,3,6,12,24,48,96,192,157,39,78,156,37,74,148,53,106,212,181,119,238,193,159,35,70,140,5,10,20,40,80,160,93,186,105,210,185,111,222,161,95,190,97,194,153,47,94,188,101,202,137,15,30,60,120,240,253,231,211,187,107,214,177,127,254,225,223,163,91,182,113,226,217,175,67,134,17,34,68,136,13,26,52,104,208,189,103,206,129,31,62,124,248,237,199,147,59,118,236,197,151,51,102,204,133,23,46,92,184,109,218,169,79,158,33,66,132,21,42,84,168,77,154,41,82,164,85,170,73,146,57,114,228,213,183,115,230,209,191,99,198,145,63,126,252,229,215,179,123,246,241,255,227,219,171,75,150,49,98,196,149,55,110,220,165,87,174,65,130,25,50,100,200,141,7,14,28,56,112,224,221,167,83,166,81,162,89,178,121,242,249,239,195,155,43,86,172,69,138,9,18,36,72,144,61,122,244,245,247,243,251,235,203,139,11,22,44,88,176,125,250,233,207,131,27,54,108,216,173,71,142,0]; var f = []; var u = []; var p = []; var g = []; var v = []; var y = 2; function b(t,e){ var i; t > e && (i = t,t = e,e = i),i = e,i *= e,i += e,i >>= 1,g[i += t] = 1 }function x(t,i){ var n; for(p[t + e * i] = 1,n = -2; n < 2; n++)p[t + n + e * (i - 2)] = 1,p[t - 2 + e * (i + n + 1)] = 1,p[t + 2 + e * (i + n)] = 1,p[t + n + 1 + e * (i + 2)] = 1; for(n = 0; n < 2; n++)b(t - 1,i + n),b(t + 1,i - n),b(t - n,i - 1),b(t + n,i + 1) }function m(t){ for(;t >= 255;)t = ((t -= 255) >> 8) + (255 & t); return t }var w = []; function S(t,e,i,n){ var o,r,s; for(o = 0; o < n; o++)f[i + o] = 0; for(o = 0; o < e; o++){ if((s = l[f[t + o] ^ f[i]]) != 255)for(r = 1; r < n; r++)f[i + r - 1] = f[i + r] ^ c[m(s + w[n - r])]; else for(r = i; r < i + n; r++)f[r] = f[r + 1]; f[i + n - 1] = s == 255 ? 0 : c[m(s + w[0])] } }function z(t,e){ var i; return t > e && (i = t,t = e,e = i),i = e,i += e * e,i >>= 1,g[i += t] }function M(t){ var i,n,o,r; switch(t){ case 0:for(n = 0; n < e; n++)for(i = 0; i < e; i++)i + n & 1 || z(i,n) || (p[i + n * e] ^= 1); break; case 1:for(n = 0; n < e; n++)for(i = 0; i < e; i++)1 & n || z(i,n) || (p[i + n * e] ^= 1); break; case 2:for(n = 0; n < e; n++)for(o = 0,i = 0; i < e; i++,o++)o == 3 && (o = 0),o || z(i,n) || (p[i + n * e] ^= 1); break; case 3:for(r = 0,n = 0; n < e; n++,r++)for(r == 3 && (r = 0),o = r,i = 0; i < e; i++,o++)o == 3 && (o = 0),o || z(i,n) || (p[i + n * e] ^= 1); break; case 4:for(n = 0; n < e; n++)for(o = 0,r = n >> 1 & 1,i = 0; i < e; i++,o++)o == 3 && (o = 0,r = !r),r || z(i,n) || (p[i + n * e] ^= 1); break; case 5:for(r = 0,n = 0; n < e; n++,r++)for(r == 3 && (r = 0),o = 0,i = 0; i < e; i++,o++)o == 3 && (o = 0),(i & n & 1) + !(!o | !r) || z(i,n) || (p[i + n * e] ^= 1); break; case 6:for(r = 0,n = 0; n < e; n++,r++)for(r == 3 && (r = 0),o = 0,i = 0; i < e; i++,o++)o == 3 && (o = 0),(i & n & 1) + (o && o == r) & 1 || z(i,n) || (p[i + n * e] ^= 1); break; case 7:for(r = 0,n = 0; n < e; n++,r++)for(r == 3 && (r = 0),o = 0,i = 0; i < e; i++,o++)o == 3 && (o = 0),(o && o == r) + (i + n & 1) & 1 || z(i,n) || (p[i + n * e] ^= 1) } }function B(t){ var e; var i = 0; for(e = 0; e <= t; e++)v[e] >= 5 && (i += 3 + v[e] - 5); for(e = 3; e < t - 1; e += 2)v[e - 2] == v[e + 2] && v[e + 2] == v[e - 1] && v[e - 1] == v[e + 1] && 3 * v[e - 1] == v[e] && (v[e - 3] == 0 || e + 3 > t || 3 * v[e - 3] >= 4 * v[e] || 3 * v[e + 3] >= 4 * v[e]) && (i += 40); return i }function I(){ var t; var i; var n; var o; var r; var s = 0; var a = 0; for(i = 0; i < e - 1; i++)for(t = 0; t < e - 1; t++)(p[t + e * i] && p[t + 1 + e * i] && p[t + e * (i + 1)] && p[t + 1 + e * (i + 1)] || !(p[t + e * i] || p[t + 1 + e * i] || p[t + e * (i + 1)] || p[t + 1 + e * (i + 1)])) && (s += 3); for(i = 0; i < e; i++){ for(v[0] = 0,n = o = t = 0; t < e; t++)(r = p[t + e * i]) == o ? v[n]++ : v[++n] = 1,a += (o = r) ? 1 : -1; s += B(n) }a < 0 && (a = -a); var h = a; var d = 0; for(h += h << 2,h <<= 1; h > e * e;)h -= e * e,d++; for(s += 10 * d,t = 0; t < e; t++){ for(v[0] = 0,n = o = i = 0; i < e; i++)(r = p[t + e * i]) == o ? v[n]++ : v[++n] = 1,o = r; s += B(n) }return s }var k = null; return{ api:{ get ecclevel(){ return y },set ecclevel(t){ y = t },get size(){ return _size },set size(t){ _size = t },get canvas(){ return k },set canvas(t){ k = t },getFrame:function(v){ return (function(v){ var B,k,P,W,R,O,T,L; W = v.length,t = 0; do{ if(t++,P = 4 * (y - 1) + 16 * (t - 1),i = d[P++],n = d[P++],o = d[P++],r = d[P],W <= (P = o * (i + n) + n - 3 + (t <= 9)))break }while(t < 40); for(e = 17 + 4 * t,R = o + (o + r) * (i + n) + n,W = 0; W < R; W++)u[W] = 0; for(f = v.slice(0),W = 0; W < e * e; W++)p[W] = 0; for(W = 0; W < (e * (e + 1) + 1) / 2; W++)g[W] = 0; for(W = 0; W < 3; W++){ for(P = 0,k = 0,W == 1 && (P = e - 7),W == 2 && (k = e - 7),p[k + 3 + e * (P + 3)] = 1,B = 0; B < 6; B++)p[k + B + e * P] = 1,p[k + e * (P + B + 1)] = 1,p[k + 6 + e * (P + B)] = 1,p[k + B + 1 + e * (P + 6)] = 1; for(B = 1; B < 5; B++)b(k + B,P + 1),b(k + 1,P + B + 1),b(k + 5,P + B),b(k + B + 1,P + 5); for(B = 2; B < 4; B++)p[k + B + e * (P + 2)] = 1,p[k + 2 + e * (P + B + 1)] = 1,p[k + 4 + e * (P + B)] = 1,p[k + B + 1 + e * (P + 4)] = 1 }if(t > 1)for(W = s[t],k = e - 7; ;){ for(B = e - 7; B > W - 3 && (x(B,k),!(B < W));)B -= W; if(k <= W + 9)break; x(6,k -= W),x(k,6) }for(p[8 + e * (e - 8)] = 1,k = 0; k < 7; k++)b(7,k),b(e - 8,k),b(7,k + e - 7); for(B = 0; B < 8; B++)b(B,7),b(B + e - 8,7),b(B,e - 8); for(B = 0; B < 9; B++)b(B,8); for(B = 0; B < 8; B++)b(B + e - 8,8),b(8,B); for(k = 0; k < 7; k++)b(8,k + e - 7); for(B = 0; B < e - 14; B++)1 & B ? (b(8 + B,6),b(6,8 + B)) : (p[8 + B + 6 * e] = 1,p[6 + e * (8 + B)] = 1); if(t > 6)for(W = a[t - 7],P = 17,B = 0; B < 6; B++)for(k = 0; k < 3; k++,P--)1 & (P > 11 ? t >> P - 12 : W >> P) ? (p[5 - B + e * (2 - k + e - 11)] = 1,p[2 - k + e - 11 + e * (5 - B)] = 1) : (b(5 - B,2 - k + e - 11),b(2 - k + e - 11,5 - B)); for(k = 0; k < e; k++)for(B = 0; B <= k; B++)p[B + e * k] && b(B,k); for(R = f.length,O = 0; O < R; O++)u[O] = f.charCodeAt(O); if(f = u.slice(0),R >= (B = o * (i + n) + n) - 2 && (R = B - 2,t > 9 && R--),O = R,t > 9){ for(f[O + 2] = 0,f[O + 3] = 0; O--;)W = f[O],f[O + 3] |= 255 & W << 4,f[O + 2] = W >> 4; f[2] |= 255 & R << 4,f[1] = R >> 4,f[0] = 64 | R >> 12 }else{ for(f[O + 1] = 0,f[O + 2] = 0; O--;)W = f[O],f[O + 2] |= 255 & W << 4,f[O + 1] = W >> 4; f[1] |= 255 & R << 4,f[0] = 64 | R >> 4 }for(O = R + 3 - (t < 10); O < B;)f[O++] = 236,f[O++] = 17; for(w[0] = 1,O = 0; O < r; O++){ for(w[O + 1] = 1,T = O; T > 0; T--)w[T] = w[T] ? w[T - 1] ^ c[m(l[w[T]] + O)] : w[T - 1]; w[0] = c[m(l[w[0]] + O)] }for(O = 0; O <= r; O++)w[O] = l[w[O]]; for(P = B,k = 0,O = 0; O < i; O++)S(k,o,P,r),k += o,P += r; for(O = 0; O < n; O++)S(k,o + 1,P,r),k += o + 1,P += r; for(k = 0,O = 0; O < o; O++){ for(T = 0; T < i; T++)u[k++] = f[O + T * o]; for(T = 0; T < n; T++)u[k++] = f[i * o + O + T * (o + 1)] }for(T = 0; T < n; T++)u[k++] = f[i * o + O + T * (o + 1)]; for(O = 0; O < r; O++)for(T = 0; T < i + n; T++)u[k++] = f[B + O + T * r]; for(f = u,B = k = e - 1,P = R = 1,L = (o + r) * (i + n) + n,O = 0; O < L; O++)for(W = f[O],T = 0; T < 8; T++,W <<= 1){ 128 & W && (p[B + e * k] = 1); do{ R ? B-- : (B++,P ? k != 0 ? k-- : (P = !P,(B -= 2) == 6 && (B--,k = 9)) : k != e - 1 ? k++ : (P = !P,(B -= 2) == 6 && (B--,k -= 8))),R = !R }while(z(B,k)) }for(f = p.slice(0),W = 0,k = 3e4,P = 0; P < 8 && (M(P),(B = I()) < k && (k = B,W = P),W != 7); P++)p = f.slice(0); for(W != P && M(W),k = h[W + (y - 1 << 3)],P = 0; P < 8; P++,k >>= 1)1 & k && (p[e - 1 - P + 8 * e] = 1,P < 6 ? p[8 + e * P] = 1 : p[8 + e * (P + 1)] = 1); for(P = 0; P < 7; P++,k >>= 1)1 & k && (p[8 + e * (e - 7 + P)] = 1,P ? p[6 - P + 8 * e] = 1 : p[7 + 8 * e] = 1); return p }(v)) },utf16to8:function(t){ var e,i,n,o; for(e = '',n = t.length,i = 0; i < n; i++)(o = t.charCodeAt(i)) >= 1 && o <= 127 ? e += t.charAt(i) : o > 2047 ? (e += String.fromCharCode(224 | o >> 12 & 15),e += String.fromCharCode(128 | o >> 6 & 63),e += String.fromCharCode(128 | o >> 0 & 63)) : (e += String.fromCharCode(192 | o >> 6 & 31),e += String.fromCharCode(128 | o >> 0 & 63)); return e },draw:function(t,i,n,o,r){ i.drawView(n,o); var s = i.ctx; var a = n.contentSize; var h = a.width; var d = a.height; var l = a.left; var c = a.top; o.borderRadius,o.backgroundColor; var f = o.color; var u = void 0 === f ? '#000000' : f; o.border,n.contentSize.left,n.borderSize.left,n.contentSize.top,n.borderSize.top; if(y = r || y,s){ s.save(),i.setOpacity(o),i.setTransform(n,o); var p = Math.min(h,d); t = this.utf16to8(t); var g = this.getFrame(t); var v = p / e; s.setFillStyle(u); for(var b = 0; b < e; b++)for(var x = 0; x < e; x++)g[x * e + b] && s.fillRect(l + v * b,c + v * x,v,v); s.restore(),i.setBorder(n,o) }else console.warn('No canvas provided to draw QR code in!') } }} }()); var st = c; var at = l; var ht = f; var dt = d; var lt = (function(){ function t(t,e){ var i; var n = this; this.v = '1.9.3.1',this.id = null,this.pixelRatio = 1,this.width = 0,this.height = 0,this.sleep = 1e3 / 30,this.count = 0,this.isRate = !1,this.isDraw = !0,this.isCache = !0,this.fixed = '',this.useCORS = !1,this.imageBus = [],this.createImage = function(t,e){ return new Promise(function(i,o){ var r = null; r = n.canvas.createImage ? n.canvas.createImage() : new Image(),e && r.setAttribute('crossOrigin','Anonymous'),r.src = t,r.onload = function(){ i({ width:this.naturalWidth || this.width,height:this.naturalHeight || this.height,path:r,src:this.src }) },r.onerror = function(t){ o(t) } }) },this.options = t,Object.assign(this,t),this.component = e,this.ctx = ((i = t.context).setFonts = function(t){ var e = t.fontFamily; var n = void 0 === e ? 'sans-serif' : e; var o = t.fontSize; var r = void 0 === o ? 14 : o; var a = t.fontWeight; var h = void 0 === a ? 'normal' : a; var d = t.fontStyle; var l = void 0 === d ? 'normal' : d; B == s.MP_TOUTIAO && (h = h == 'bold' ? 'bold' : '',l = l == 'italic' ? 'italic' : ''),i.font = l + ' ' + h + ' ' + Math.round(r) + 'px ' + n },i.draw ? i : Object.assign(i,{ setStrokeStyle:function(t){ i.strokeStyle = t },setLineWidth:function(t){ i.lineWidth = t },setLineCap:function(t){ i.lineCap = t },setFillStyle:function(t){ i.fillStyle = t },setFontSize:function(t){ i.font = String(t) + 'px sans-serif' },setGlobalAlpha:function(t){ i.globalAlpha = t },setLineJoin:function(t){ i.lineJoin = t },setTextAlign:function(t){ i.textAlign = t },setMiterLimit:function(t){ i.miterLimit = t },setShadow:function(t,e,n,o){ i.shadowOffsetX = t,i.shadowOffsetY = e,i.shadowBlur = n,i.shadowColor = o },setTextBaseline:function(t){ i.textBaseline = t },createCircularGradient:function(){},draw:function(){} })),this.progress = 0,this.root = { width:t.width,height:t.height,fontSizeRate:1,fixedLine:null },this.size = this.root,this.init(); var o = 0; Object.defineProperty(this,'progress',{ configurable:!0,set:function(t){ o = t,n.lifecycle('onProgress',t / n.count) },get:function(){ return o || 0 } }) }return t.prototype.lifecycle = function(t,e){ this.options.listen && this.options.listen[t] && this.options.listen[t](e) },t.prototype.init = function(){ (this.canvas.height || s.WEB == B) && (this.canvas.height = this.size.height * this.pixelRatio,this.canvas.width = this.size.width * this.pixelRatio,this.ctx.scale(this.pixelRatio,this.pixelRatio)) },t.prototype.clear = function(){ this.ctx.clearRect(0,0,this.size.width,this.size.height) },t.prototype.clipPath = function(t,e,i,n,o,r,s){ void 0 === r && (r = !1),void 0 === s && (s = !1); var a = this.ctx; if(/polygon/.test(o)){ var h = o.match(/-?\d+(rpx|px|%)?\s+-?\d+(rpx|px|%)?/g) || []; a.beginPath(),h.map(function(o){ var r = o.split(' '); var s = r[0]; var a = r[1]; return[W(s,i) + t,W(a,n) + e] }).forEach(function(t,e){ e == 0 ? a.moveTo(t[0],t[1]) : a.lineTo(t[0],t[1]) }),a.closePath(),s && a.stroke(),r && a.fill() } },t.prototype.roundRect = function(t,e,i,n,o,r,s){ if(void 0 === r && (r = !1),void 0 === s && (s = !1),!(o < 0)){ var a = this.ctx; if(a.beginPath(),o){ var h = o || {}; var d = h.borderTopLeftRadius; var l = void 0 === d ? o || 0 : d; var c = h.borderTopRightRadius; var f = void 0 === c ? o || 0 : c; var u = h.borderBottomRightRadius; var p = void 0 === u ? o || 0 : u; var g = h.borderBottomLeftRadius; var v = void 0 === g ? o || 0 : g; a.arc(t + i - p,e + n - p,p,0,0.5 * Math.PI),a.lineTo(t + v,e + n),a.arc(t + v,e + n - v,v,0.5 * Math.PI,Math.PI),a.lineTo(t,e + l),a.arc(t + l,e + l,l,Math.PI,1.5 * Math.PI),a.lineTo(t + i - f,e),a.arc(t + i - f,e + f,f,1.5 * Math.PI,2 * Math.PI),a.lineTo(t + i,e + n - p) }else a.rect(t,e,i,n); a.closePath(),s && a.stroke(),r && a.fill() } },t.prototype.setTransform = function(t,e){ var i = e.transform; var n = e.transformOrigin; var o = this.ctx; var r = i || {}; var s = r.scaleX; var a = void 0 === s ? 1 : s; var h = r.scaleY; var d = void 0 === h ? 1 : h; var l = r.translateX; var c = void 0 === l ? 0 : l; var f = r.translateY; var u = void 0 === f ? 0 : f; var p = r.rotate; var g = void 0 === p ? 0 : p; var v = r.skewX; var y = void 0 === v ? 0 : v; var b = r.skewY; var x = void 0 === b ? 0 : b; var m = t.left; var w = t.top; var S = t.width; var z = t.height; c = W(c,S) || 0,u = W(u,z) || 0; var M = { top:W('0%',1),center:W('50%',1),bottom:W('100%',1) }; var B = { left:W('0%',1),center:W('50%',1),right:W('100%',1) }; if(n = n.split(' ').filter(function(t,e){ return e < 2 }).reduce(function(t,e){ if(/\d+/.test(e)){ var i = W(e,1) / (/px|rpx$/.test(e) ? P(t.x) ? z : S : 1); return P(t.x) ? Object.assign(t,{ y:i }) : Object.assign(t,{ x:i }) }return P(B[e]) && !P(t.x) ? Object.assign(t,{ x:B[e] }) : Object.assign(t,{ y:M[e] || 0.5 }) },{}),(c || u) && o.translate(c,u),(a || d) && o.scale(a,d),g){ var I = m + S * n.x; var k = w + z * n.y; o.translate(I,k),o.rotate(g * Math.PI / 180),o.translate(-I,-k) }(y || x) && o.transform(1,Math.tan(x * Math.PI / 180),Math.tan(y * Math.PI / 180),1,0,0) },t.prototype.setBackground = function(t,e,i,n,o){ var r = this.ctx; t && t != x ? R(t) ? O(t,e,i,n,o,r) : r.setFillStyle(t) : [s.MP_TOUTIAO,s.MP_BAIDU].includes(B) ? r.setFillStyle('rgba(0,0,0,0)') : r.setFillStyle(x) },t.prototype.setShadow = function(t){ var e = t.boxShadow; var i = void 0 === e ? [] : e; var n = this.ctx; if(i.length){ var o = i[0]; var r = i[1]; var s = i[2]; var a = i[3]; n.setShadow(o,r,s,a) } },t.prototype.setBorder = function(t,e){ var i = this.ctx; var n = t.width; var o = t.height; var r = t.left; var s = t.top; var a = e.border; var h = e.borderBottom; var d = e.borderTop; var l = e.borderRight; var c = e.borderLeft; var f = e.borderRadius; var u = e.lineCap; var p = a || {}; var g = p.borderWidth; var v = void 0 === g ? 0 : g; var y = p.borderStyle; var b = p.borderColor; var x = h || {}; var m = x.borderBottomWidth; var w = void 0 === m ? v : m; var S = x.borderBottomStyle; var z = void 0 === S ? y : S; var M = x.borderBottomColor; var I = void 0 === M ? b : M; var k = d || {}; var P = k.borderTopWidth; var W = void 0 === P ? v : P; var R = k.borderTopStyle; var O = void 0 === R ? y : R; var T = k.borderTopColor; var L = void 0 === T ? b : T; var A = l || {}; var F = A.borderRightWidth; var j = void 0 === F ? v : F; var C = A.borderRightStyle; var E = void 0 === C ? y : C; var H = A.borderRightColor; var $ = void 0 === H ? b : H; var U = c || {}; var _ = U.borderLeftWidth; var D = void 0 === _ ? v : _; var X = U.borderLeftStyle; var N = void 0 === X ? y : X; var Y = U.borderLeftColor; var V = void 0 === Y ? b : Y; var G = f || {}; var q = G.borderTopLeftRadius; var J = void 0 === q ? f || 0 : q; var Q = G.borderTopRightRadius; var Z = void 0 === Q ? f || 0 : Q; var K = G.borderBottomRightRadius; var tt = void 0 === K ? f || 0 : K; var et = G.borderBottomLeftRadius; var it = void 0 === et ? f || 0 : et; if(h || c || d || l || a){ var nt = function(t,e,n){ e == 'dashed' ? /mp/.test(B) ? i.setLineDash([Math.ceil(4 * t / 3),Math.ceil(4 * t / 3)]) : i.setLineDash([Math.ceil(6 * t),Math.ceil(6 * t)]) : e == 'dotted' && i.setLineDash([t,t]),i.setStrokeStyle(n) }; var ot = function(t,e,n,o,r,s,a,h,d,l,c,f,p,g,v){ i.save(),i.setLineCap(v ? 'square' : u),i.setLineWidth(f),nt(f,p,g),i.beginPath(),i.arc(t,e,a,Math.PI * d,Math.PI * l),i.lineTo(n,o),i.arc(r,s,h,Math.PI * l,Math.PI * c),i.stroke(),i.restore() }; if(i.save(),a && !h && !c && !d && !l)return i.setLineWidth(v),nt(v,y,b),this.roundRect(r,s,n,o,f,!1,!!b),void i.restore(); w && ot(r + n - tt,s + o - tt,r + it,s + o,r + it,s + o - it,tt,it,0.25,0.5,0.75,w,z,I,D && j),D && ot(r + it,s + o - it,r,s + J,r + J,s + J,it,J,0.75,1,1.25,D,N,V,W && w),W && ot(r + J,s + J,r + n - Z,s,r + n - Z,s + Z,J,Z,1.25,1.5,1.75,W,O,L,D && j),j && ot(r + n - Z,s + Z,r + n,s + o - tt,r + n - tt,s + o - tt,Z,tt,1.75,2,0.25,j,E,$,W && w) } },t.prototype.setOpacity = function(t){ var e = t.opacity; var i = void 0 === e ? 1 : e; this.ctx.setGlobalAlpha(i) },t.prototype.drawPattern = function(t,e,o){ return i(this,void 0,void 0,function(){ var i = this; return n(this,function(n){ return[2,new Promise(function(n,r){ i.drawView(e,o,!0,!1,!0); var s = i; var a = s.ctx; s.canvas; var h = e.width; var d = e.height; var l = e.left; var c = e.top; var f = o || {}; var u = f.borderRadius; var p = void 0 === u ? 0 : u; var g = f.backgroundImage; var v = f.backgroundRepeat; var y = void 0 === v ? 'repeat' : v; g && (function(t){ var r = a.createPattern(t.src,y); a.setFillStyle(r),i.roundRect(l,c,h,d,p,!0,!1),i.setBorder(e,o),n() }(t)) })] }) }) },t.prototype.drawView = function(t,e,i,n,o){ void 0 === i && (i = !0),void 0 === n && (n = !0),void 0 === o && (o = !0); var r = this.ctx; var s = t.width; var a = t.height; var h = t.left; var d = t.top; var l = e || {}; var c = l.borderRadius; var f = void 0 === c ? 0 : c; var u = l.backgroundColor; var p = void 0 === u ? x : u; var g = l.overflow; e.opacity && this.setOpacity(e),this.setTransform(t,e),o && (r.save(),this.setShadow(e)),i && this.setBackground(p,s,a,h,d),e.clipPath ? this.clipPath(h,d,s,a,e.clipPath,i,!1) : this.roundRect(h,d,s,a,f,i,!1),o && r.restore(),n && this.setBorder(t,e),g == 'hidden' && r.clip() },t.prototype.drawImage = function(t,e,o,r){ return void 0 === e && (e = {}),void 0 === o && (o = {}),void 0 === r && (r = !0),i(this,void 0,void 0,function(){ var a = this; return n(this,function(h){ switch(h.label){ case 0:return[4,new Promise(function(h,d){ return i(a,void 0,void 0,function(){ var i; var a; var d; var l; var c; var f; var u; var p; var g; var v; var y; var b; var w; var S; var z; var M; var I; var k; var P; var R; var O = this; return n(this,function(n){ return i = this.ctx,a = o.borderRadius,d = void 0 === a ? 0 : a,l = o.backgroundColor,c = void 0 === l ? x : l,f = o.objectFit,u = void 0 === f ? m : f,p = o.backgroundSize,g = void 0 === p ? m : p,v = o.objectPosition,y = o.backgroundPosition,b = o.boxShadow,o.backgroundImage && (u = g,v = y),b && this.drawView(e,Object.assign(o,{ backgroundColor:c || b && (c || '#ffffff') }),!0,!1,!0),w = e.width,S = e.height,z = e.left,M = e.top,i.save(),I = e.contentSize.left - e.borderSize.left,k = e.contentSize.top - e.borderSize.top,r || (this.setOpacity(o),this.setTransform(e,o),this.setBackground(c,w,S,z,M),this.roundRect(z,M,w,S,d,!!(d || !b && c),!1)),z += I,M += k,i.clip(),P = function(t){ if(u !== m){ var n = (function(t,e,i){ var n = t.objectFit; var o=t.objectPosition; var r=e.width/e.height; var s=i.width/i.height; var a = 1; "contain" == n && r >= s || "cover" == n && r < s ? a = e.height / i.height : ('contain'==n && r < s || "cover" == n && r >= s) && (a = e.width / i.width); var h = i.width * a; var d=i.height*a; var l=/^\d+px|rpx$/.test(null==o?void 0:o[0])?W(null==o?void 0:o[0],e.width):(e.width-h)*(/%$/.test(null==o?void 0:o[0])?W(null==o?void 0:o[0],1):{left:0,center:.5,right:1}[(null==o?void 0:o[0])||"center"]); var c=/^\d+px|rpx$/.test(null==o?void 0:o[1])?W(null==o?void 0:o[1],e.height):(e.height-d)*(/%$/.test(null==o?void 0:o[1])?W(null==o?void 0:o[1],1):{top:0,center:.5,bottom:1}[(null==o?void 0:o[1])||"center"]); var f=function(t,e){return[(t-l)/a,(e-c)/a]}; var u=f(0,0); var p=u[0]; var g=u[1]; var v=f(e.width,e.height); var y=v[0]; var b = v[1]; return{ sx:Math.max(p,0),sy:Math.max(g,0),sw:Math.min(y - p,i.width),sh:Math.min(b - g,i.height),dx:Math.max(l,0),dy:Math.max(c,0),dw:Math.min(h,e.width),dh:Math.min(d,e.height) } }({ objectFit:u,objectPosition:v },e.contentSize,t)); var o = n.sx; var r = n.sy; var a = n.sh; var h = n.sw; var d = n.dx; var l = n.dy; var c = n.dh; var f = n.dw; B == s.MP_BAIDU ? i.drawImage(t.src,d + z,l + M,f,c,o,r,h,a) : i.drawImage(t.src,o,r,h,a,d + z,l + M,f,c) }else i.drawImage(t.src,z,M,w,S) },R = function(){ i.restore(),O.drawView(e,o,!1,!0,!1),h(1) },(function(t){ P(t),R() }(t)),[2] }) }) })]; case 1:return h.sent(),[2] } }) }) },t.prototype.drawText = function(t,e,i,n){ var o; var r; var s = this.ctx; var a = e.borderSize; var h = e.contentSize; var d = e.left; var l = e.top; var c = h.width; var f = h.height; var u = h.left - a.left; var p = h.top - a.top; var g = i.color; var v = void 0 === g ? '#000000' : g; var y = i.lineHeight; var b = void 0 === y ? '1.4em' : y; var x = i.fontSize; var m = void 0 === x ? 14 : x; var w = i.fontWeight; var S = i.fontFamily; var z = i.fontStyle; var M = i.textAlign; var B = void 0 === M ? 'left' : M; var I = i.verticalAlign; var k = void 0 === I ? 'middle' : I; var P = i.backgroundColor; var R = i.lineClamp; var O = i.backgroundClip; var T = i.textDecoration; if(this.drawView(e,i,O != at),b = W(b,m),t){ switch(s.save(),d += u,l += p,s.setFonts({ fontFamily:S,fontSize:m,fontWeight:w,fontStyle:z }),s.setTextBaseline('middle'),s.setTextAlign(B),O ? this.setBackground(P,c,f,d,l) : s.setFillStyle(v),l += m / 2,B){ case'left':break; case'center':d += 0.5 * c; break; case'right':d += c }var L = n.lines * b; var A = Math.ceil((f - L) / 2); switch(A < 0 && (A = 0),k){ case'top':break; case'middle':l += A; break; case'bottom':l += 2 * A }var F = (b - n.fontHeight) / 2; var j = function(t,e,i){ var o = t; switch(B){ case'left':t = t,o += i; break; case'center':o = (t -= i / 2) + i; break; case'right':o = t,t -= i }T && (s.setLineWidth(m / 13),s.beginPath(),e -= F,/\bunderline\b/.test(T) && (s.moveTo(t,e - 0.5 * n.fontHeight),s.lineTo(o,e - 0.5 * n.fontHeight)),/\boverline\b/.test(T) && (s.moveTo(t,e - 1.5 * n.fontHeight),s.lineTo(o,e - 1.5 * n.fontHeight)),/\bline-through\b/.test(T) && (s.moveTo(t,e - n.fontHeight),s.lineTo(o,e - n.fontHeight)),s.closePath(),s.setStrokeStyle(v),s.stroke()) }; if(!n.widths || n.widths.length == 1 && n.widths[0].total <= h.width)return s.fillText(t,d,l + F),j(d,l += b,((r = (o = n == null ? void 0 : n.widths) === null || void 0 === o ? void 0 : o[0]) === null || void 0 === r ? void 0 : r.total) || n.text),s.restore(),void this.setBorder(e,i); for(var C = t.split(''),E = l,H = d,$ = '',U = 0,_ = 0; _ <= C.length; _++){ var D = C[_] || ''; var X = D === '\n'; var N = D == ''; var Y = $ + (D = X ? '' : D); var V = s.measureText(Y).width; if(U >= R)break; if(H = d,(V = V) > h.width || X || N){ if(U++,$ = N && V <= h.width ? Y : $,U === R && V > c){ for(;s.measureText($ + '...').width > h.width && !($.length <= 1);)$ = $.substring(0,$.length - 1); $ += '...' }if(s.fillText($,H,l + F),j(H,l += b,V),$ = D,l > E + f)break }else $ = Y }s.restore() } },t.prototype.source = function(t){ var e; return i(this,void 0,void 0,function(){ var i; var o; var r; var s = this; return n(this,function(n){ switch(n.label){ case 0:if(i = +new Date(),JSON.stringify(t) == '{}')return[2]; if(!t.type)for(o in t.type = dt,t.css = t.css || {},t)['views','children','type','css'].includes(o) || (t.css[o] = t[o],delete t[o]); return((e = t.css) === null || void 0 === e ? void 0 : e.width) || t.css || (t.css = {}),[4,this.create(t)]; case 1:return r = n.sent(),this.size = (r == null ? void 0 : r.layout()) || {},this.node = r,this.onEffectFinished().then(function(t){ return s.lifecycle('onEffectSuccess',t) }).catch(function(t){ return s.lifecycle('onEffectFail',t) }),console.log('布局用时：' + (+new Date() - i) + 'ms'),[2,this.size] } }) }) },t.prototype.getImageInfo = function(t){ return this.imageBus[t] || (this.imageBus[t] = this.createImage(t,this.useCORS)),this.imageBus[t] },t.prototype.create = function(t,o){ var r,s; return i(this,void 0,void 0,function(){ var i,a,h,d,l,c,f,u,p,v,y,b,x,m,w,S,z; return n(this,function(n){ switch(n.label){ case 0:if(i = t.type == st,a = [at,ht].includes(t.type),h = t.css || {},d = h.backgroundImage,l = h.display,i && !t.src && !t.url || a && !t.text)return[2]; if(l == g)return[2]; if(a && (t.text = String(t.text)),!(i || t.type == dt && d))return[3,4]; c = i ? t.src : '',f = /url\((.+)\)/,d && ((r = f.exec(d)) === null || void 0 === r ? void 0 : r[1]) && (c = ((s = f.exec(d)) === null || void 0 === s ? void 0 : s[1]) || ''),n.label = 1; case 1:return n.trys.push([1,3,,4]),[4,this.getImageInfo(c)]; case 2:return u = n.sent(),p = u.width,v = u.height,!(y = u.path) && i ? [2] : (y && (t.attributes = Object.assign(t.attributes || {},{ width:p,height:v,path:y,src:y,naturalSrc:c })),[3,4]); case 3:return b = n.sent(),t.type != dt ? [2] : (this.lifecycle('onEffectFail',e(e({},b),{ src:c })),[3,4]); case 4:if(this.count += 1,x = new ot(t,o,this.root,this.ctx),!(m = t.views || t.children))return[3,8]; w = 0,n.label = 5; case 5:return w < m.length ? (S = m[w],[4,this.create(S,x)]) : [3,8]; case 6:(z = n.sent()) && x.add(z),n.label = 7; case 7:return w++,[3,5]; case 8:return[2,x] } }) }) },t.prototype.drawNode = function(t,e){ return void 0 === e && (e = !1),i(this,void 0,void 0,function(){ var i,o,r,s,a,h,d,l,c,f,u,p,g,v,y,b,x,m,w,S; return n(this,function(n){ switch(n.label){ case 0:return i = t.layoutBox,o = t.computedStyle,r = t.attributes,s = t.name,a = t.children,h = t.fixedLine,d = t.attributes,l = d.src,c = d.text,['fixed'].includes(o.position) && !e ? [2] : (this.ctx.save(),s !== dt ? [3,7] : l ? o.backgroundRepeat ? [4,this.drawPattern(r,i,o)] : [3,2] : [3,5]); case 1:return n.sent(),[3,4]; case 2:return[4,this.drawImage(r,i,o,!1)]; case 3:n.sent(),n.label = 4; case 4:return[3,6]; case 5:this.drawView(i,o),n.label = 6; case 6:return[3,10]; case 7:return s === st && l ? [4,this.drawImage(r,i,o,!1)] : [3,9]; case 8:return n.sent(),[3,10]; case 9:s === at ? this.drawText(c,i,o,r) : s === ht && rt.api && rt.api.draw(c,this,i,o),n.label = 10; case 10:if(this.progress += 1,u = (f = h || {}).beforeElements,p = f.afterElements,!u)return[3,14]; g = 0,v = u,n.label = 11; case 11:return g < v.length ? (S = v[g],[4,this.drawNode(S)]) : [3,14]; case 12:n.sent(),n.label = 13; case 13:return g++,[3,11]; case 14:if(!a)return[3,18]; y = Object.values ? Object.values(a) : Object.keys(a).map(function(t){ return a[t] }),b = 0,x = y,n.label = 15; case 15:return b < x.length ? (S = x[b]).computedStyle.position === 'absolute' ? [3,17] : [4,this.drawNode(S)] : [3,18]; case 16:n.sent(),n.label = 17; case 17:return b++,[3,15]; case 18:if(!p)return[3,22]; m = 0,w = p,n.label = 19; case 19:return m < w.length ? (S = w[m],[4,this.drawNode(S)]) : [3,22]; case 20:n.sent(),n.label = 21; case 21:return m++,[3,19]; case 22:return this.ctx.restore(),[2] } }) }) },t.prototype.render = function(t){ var e = this; return void 0 === t && (t = 30),new Promise(function(o,r){ return i(e,void 0,void 0,function(){ var e,i,s,a,h,d,l,c,f,u; return n(this,function(n){ switch(n.label){ case 0:return e = +new Date(),this.init(),[4,(p = t,void 0 === p && (p = 0),new Promise(function(t){ return setTimeout(t,p) }))]; case 1:n.sent(),n.label = 2; case 2:if(n.trys.push([2,14,,15]),!this.node)return[3,12]; if(i = this.root.fixedLine || {},s = i.beforeElements,a = i.afterElements,!s)return[3,6]; h = 0,d = s,n.label = 3; case 3:return h < d.length ? (f = d[h],[4,this.drawNode(f,!0)]) : [3,6]; case 4:n.sent(),n.label = 5; case 5:return h++,[3,3]; case 6:return[4,this.drawNode(this.node)]; case 7:if(n.sent(),!a)return[3,11]; l = 0,c = a,n.label = 8; case 8:return l < c.length ? (f = c[l],[4,this.drawNode(f,!0)]) : [3,11]; case 9:n.sent(),n.label = 10; case 10:return l++,[3,8]; case 11:return o(this.node),[3,13]; case 12:this.lifecycle('onEffectFail','node is empty'),n.label = 13; case 13:return[3,15]; case 14:return u = n.sent(),this.lifecycle('onEffectFail',u),r(u),[3,15]; case 15:return console.log('渲染用时：' + (+new Date() - e - 30) + 'ms'),[2] }var p }) }) }) },t.prototype.onEffectFinished = function(){ var t = this; var e = Object.keys(this.imageBus).map(function(e){ return t.imageBus[e] }); return Promise.all(e) },t.prototype.destroy = function(){ this.node = [] },t.prototype.save = function(t){ try{ var e = t || {}; var i = e.fileType; var n = void 0 === i ? 'png' : i; var o = e.quality; var r = void 0 === o ? 1 : o; return this.canvas.toDataURL('image/' + n,r) }catch(t){ return this.lifecycle('onEffectFail','image cross domain'),t } },t }()); s.WEB == B && (window.Painter = lt),t.Painter = lt,t.default = lt,Object.defineProperty(t,'__esModule',{ value:!0 }) }));
